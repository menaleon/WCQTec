#lang racket/gui

;; Ventana principal
(define frame
  (new frame%
       [label "World Cup QaTec"]
       [width 1000]
       [height 700]))

(define mainpane
  (new pane%
       [parent frame]
       [min-width 1000]
       [min-height 565]))

(define menu
  (new pane%
       [parent frame]
       [min-width 1000]
       [min-height 135]))

;; Campo de juego
(define field-canvas
  (new canvas%
       [parent mainpane]
       [paint-callback (lambda (canvas dc)
                         (send dc set-brush "green" 'solid)
                         (send dc draw-rectangle 0 0 1000 565) ;; Se dibuja el campo de juego.
                         (send dc set-pen "white" 10 'solid)
                         (send dc set-brush "white" 'transparent)
                         (send dc draw-line 0 10 1000 10) ;; Se dibuja una de las líneas del campo.
                         (send dc draw-line 0 555 1000 555) ;; Se dibuja una de las líneas del campo.
                         (send dc draw-line 10 0 10 600) ;; Se dibuja una de las líneas del campo.
                         (send dc draw-line 975 0 975 600) ;; Se dibuja una de las líneas del campo.
                         (send dc draw-line 500 0 500 600) ;; Se dibuja una de las líneas del campo.
                         (send dc draw-ellipse 425 225 150 150) ;; Se dibuja el círculo en el centro del campo.
                         (send dc draw-rectangle 0 200 100 200) ;; Zona de portero.
                         (send dc draw-rectangle 880 200 100 200) ;; Zona de portero.
                         (send dc set-pen "brown" 10 'solid)
                         (send dc draw-line 10 200 10 400) ;; Marco de gol.
                         (send dc draw-line 970 200 970 400))]))

(define menu-canvas
  (new canvas%
       [parent menu]
       [paint-callback (lambda (canvas dc)
                         (send dc set-brush "gray" 'solid)
                         (send dc set-pen "green" 1 'transparent)
                         (send dc draw-rectangle 0 0 1000 700) ;; Menú inferior
                         (send dc set-brush "black" 'solid)
                         (send dc draw-rectangle 455 35 90 40) ;; Contador de tiempo
                         (send dc set-brush "red" 'solid)
                         (send dc draw-rectangle 360 35 90 40) ;; Contador de goles de equipo 1.
                         (send dc draw-rectangle 550 35 90 40) ;; Contador de goles de equipo 2.
                         (send dc set-text-foreground "white")
                         (send dc draw-text "0" 400 35)
                         (send dc draw-text "0" 590 35)
                         (send dc set-text-foreground "black")
                         (send dc draw-text "Equipo1" 380 15)
                         (send dc draw-text "Tiempo" 475 15)
                         (send dc draw-text "Equipo2" 570 15))]))

(define (draw_player plx ply)
  (send (send field-canvas get-dc) set-pen "brown" 10 'transparent)
  (send (send field-canvas get-dc) set-brush "pink" 'solid)
  (send (send field-canvas get-dc) draw-rectangle plx ply 20 15)
  (send (send field-canvas get-dc) set-brush "blue" 'solid)
  (send (send field-canvas get-dc) draw-rectangle plx (+ ply 15) 20 30)
  (send (send field-canvas get-dc) set-brush "black" 'solid)
  (send (send field-canvas get-dc) draw-rectangle plx (+ ply 45) 20 10))

(define (draw_ball ballx bally)
  (send (send field-canvas get-dc) set-brush "white" 'solid)
  (send (send field-canvas get-dc) set-pen "black" 2 'solid)
  (send (send field-canvas get-dc) draw-ellipse ballx bally 25 25))
         
(define (render-menu seconds)
  (send (send menu-canvas get-dc) set-text-foreground "white")
  (send (send menu-canvas get-dc) draw-text (~a seconds) 495 35)
  (sleep 1)
  (send (send menu-canvas get-dc) erase)
  (send menu-canvas on-paint))

(define (update-menu seconds)
  (cond ((= seconds 300000)
         (render-menu seconds))
        (else
         (render-menu seconds)
         (update-menu (+ seconds 1)))))
          
(define (threaded-menu)
  (update-menu 0))

(define (move_player ix iy fx fy)
  (cond ((and (equal? ix fx) (equal? iy fy))
         (draw_player fx fy))
        ((and (equal? ix fx) (< iy fy))
         (draw_player ix iy)
         (move_player ix (+ iy 1) fx fy))
        ((and (equal? ix fx) (> iy fy))
         (draw_player ix iy)
         (move_player ix (- iy 1) fx fy))
        ((and (< ix fx) (equal? iy fy))
         (draw_player ix iy)
         (move_player (+ ix 1) iy fx fy))
        ((and (> ix fx) (equal? iy fy))
         (draw_player ix iy)
         (move_player (- ix 1) iy fx fy))
        ((and (< ix fx) (< iy fy))
         (draw_player ix iy)
         (move_player (+ ix 1) (+ iy 1) fx fy))
        ((and (< ix fx) (> iy fy))
         (draw_player ix iy)
         (move_player (+ ix 1) (- iy 1) fx fy))
        ((and (> ix fx) (> iy fy))
         (draw_player ix iy)
         (move_player (- ix 1) (- iy 1) fx fy))
        ((and (> ix fx) (< iy fy))
         (draw_player ix iy)
         (move_player (- ix 1) (+ iy 1) fx fy))))

(send frame show #t)
(thread threaded-menu)